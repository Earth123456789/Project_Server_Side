{% extends "general/components/layout.html" %}
{% load static %}
{% block title %}งานที่กำลังจะเกิดขึ้น - {% endblock %}
{% block nav %}
{% include "general/components/navbar.html" %}
{% endblock %}
{% block content %}

<section class="min-h-screen flex items-start justify-center space-x-8 mt-24">
    {% include "users/components/cardticket.html" %}
    {% include "users/components/cardticketview.html" %}
</section>

{% endblock %}
{% block script %}
<script src="{% static 'general/js/navbar.js' %}"></script>
<script>
    function sendTicket(ticketId) {
        Swal.fire({
            title: 'กรุณากรอกอีเมล',
            input: 'email',
            inputLabel: 'อีเมลของผู้รับ',
            inputPlaceholder: 'กรอกอีเมลที่นี่',
            showCancelButton: true,
            confirmButtonText: 'ส่ง',
            cancelButtonText: 'ยกเลิก',
            preConfirm: (email) => {
                if (!email) {
                    Swal.showValidationMessage('กรุณากรอกอีเมล');
                } else {

                    return fetch('/send-ticket/', { 
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}', 
                        },
                        body: JSON.stringify({ email: email, ticket_id: ticketId })
                    }).then(response => {
                        if (!response.ok) {
                            throw new Error(response.statusText);
                        }
                        return response.json();
                    }).then(data => {
                        Swal.fire('สำเร็จ!', data.message, 'success');
                    }).catch(error => {
                        Swal.fire('ผิดพลาด!', error.message, 'error');
                    });
                }
            }
        });
    }
    </script>
{% endblock %}

{% block footer %}
{% include "general/components/footer.html" %}
{% endblock %}